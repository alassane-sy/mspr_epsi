{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { defineComponent } from \"vue\";\nimport ImagePreview from \"./ImagePreview.vue\";\nconst MAX_NUM_IMAGES = 9;\nexport default defineComponent({\n  props: {\n    processImage: {\n      type: Function,\n      required: true\n    },\n    removeImage: {\n      type: Function,\n      required: true\n    }\n  },\n  components: {\n    ImagePreview\n  },\n  data() {\n    return {\n      draggedOver: false,\n      numPreviewImages: 0,\n      numProcessingImage: 0,\n      previewImageList: [],\n      imageUrlMap: {}\n    };\n  },\n  methods: {\n    customPreventDefault(event) {\n      event.preventDefault();\n      event.stopPropagation();\n    },\n    previewImage(image, imageId) {\n      const fileReader = new FileReader();\n      fileReader.readAsDataURL(image);\n      fileReader.onloadend = () => {\n        this.previewImageList.push({\n          imageSrc: fileReader.result,\n          imageId: imageId\n        });\n        this.numPreviewImages += 1;\n        this.numProcessingImage -= 1;\n        if (this.numProcessingImage === 0) {\n          // Finish processing and displaying all images\n          this.emitUrlList();\n        }\n      };\n    },\n    async handleImage(image) {\n      const {\n        imageId,\n        imageUrl\n      } = await this.processImage(image).catch(err => {\n        console.log(\"Error processing image: \", err);\n        return {\n          imageId: undefined,\n          imageUrl: undefined\n        };\n      });\n      if (!imageId || !imageUrl) {\n        return;\n      }\n      this.imageUrlMap[imageId] = imageUrl;\n      this.previewImage(image, imageId);\n    },\n    processImagesFromFiles(files) {\n      const uploadedImages = [...files].filter(file => {\n        return file.type.startsWith(\"image\");\n      });\n      this.numProcessingImage = Math.min(uploadedImages.length, MAX_NUM_IMAGES - this.numPreviewImages);\n      const processedImages = uploadedImages.slice(0, this.numProcessingImage);\n      processedImages.forEach(this.handleImage);\n    },\n    uploadFiles(event) {\n      if (this.numPreviewImages >= MAX_NUM_IMAGES) {\n        return;\n      }\n      const uploadedFiles = event.target.files;\n      if (!uploadedFiles) {\n        return;\n      }\n      this.processImagesFromFiles(uploadedFiles);\n    },\n    dropFiles(event) {\n      if (this.numPreviewImages >= MAX_NUM_IMAGES) {\n        return;\n      }\n      if (!event.dataTransfer) {\n        return;\n      }\n      if (!event.dataTransfer.files.length) {\n        return;\n      }\n      this.draggedOver = false;\n      this.processImagesFromFiles(event.dataTransfer.files);\n    },\n    removePreviewImage(imageId) {\n      delete this.imageUrlMap[imageId];\n      this.emitUrlList();\n      this.numPreviewImages -= 1;\n    },\n    emitUrlList() {\n      const updatedUrlList = Object.keys(this.imageUrlMap).map(key => this.imageUrlMap[key]);\n      this.$emit(\"update-urls\", updatedUrlList);\n    }\n  },\n  created() {\n    [\"dragover\", \"drop\"].forEach(eventName => {\n      document.addEventListener(eventName, this.customPreventDefault);\n    });\n  },\n  mounted() {\n    // Prevent browser from opening dragged images in a new tab\n    // and the drop event can be handled by our callback\n    [\"dragover\", \"drop\"].forEach(eventName => {\n      this.$refs.dropArea.addEventListener(eventName, this.customPreventDefault);\n    });\n    this.$refs.dropArea.addEventListener(\"drop\", this.dropFiles);\n    // Show / hide highlight animation on drop area when files are dragged in / out\n    this.$refs.dropArea.addEventListener(\"dragenter\", () => {\n      this.draggedOver = true;\n    });\n    this.$refs.dropArea.addEventListener(\"dragleave\", event => {\n      const dropAreaPosition = this.$refs.dropArea.getBoundingClientRect();\n      // Only disable highlight animation when dragleave events occurs outside of drop area.\n      // By default, dragleave event occurs when dragging into child elements (still inside drop area).\n      const surplusGap = 10; //px\n      if (event.clientX >= dropAreaPosition.left + surplusGap && event.clientX <= dropAreaPosition.right - surplusGap && event.clientY >= dropAreaPosition.top + surplusGap && event.clientY <= dropAreaPosition.bottom - surplusGap) {\n        return;\n      }\n      this.draggedOver = false;\n    });\n  },\n  beforeUnmount() {\n    [\"dragover\", \"drop\"].forEach(eventName => {\n      document.removeEventListener(eventName, this.customPreventDefault);\n    });\n  }\n});","map":{"version":3,"names":["defineComponent","ImagePreview","MAX_NUM_IMAGES","props","processImage","type","Function","required","removeImage","components","data","draggedOver","numPreviewImages","numProcessingImage","previewImageList","imageUrlMap","methods","customPreventDefault","event","preventDefault","stopPropagation","previewImage","image","imageId","fileReader","FileReader","readAsDataURL","onloadend","push","imageSrc","result","emitUrlList","handleImage","imageUrl","catch","err","console","log","undefined","processImagesFromFiles","files","uploadedImages","filter","file","startsWith","Math","min","length","processedImages","slice","forEach","uploadFiles","uploadedFiles","target","dropFiles","dataTransfer","removePreviewImage","updatedUrlList","Object","keys","map","key","$emit","created","eventName","document","addEventListener","mounted","$refs","dropArea","dropAreaPosition","getBoundingClientRect","surplusGap","clientX","left","right","clientY","top","bottom","beforeUnmount","removeEventListener"],"sources":["C:\\Users\\toumy\\OneDrive\\Bureau\\projet_mspr\\projet_vue\\a-rosa-je_mspr_epsi\\arosaje-app\\src\\components\\UploadImage.vue"],"sourcesContent":["<template>\r\n  <div class=\"drop-area\" :class=\"[{ highlight: draggedOver }]\" ref=\"dropArea\">\r\n\r\n    <i class=\"fa fa-camera\" :class=\"[{ hide: numPreviewImages }]\"></i>\r\n    <div class=\"drop-area-text\" :class=\"[{ hide: numPreviewImages }]\">\r\n      <p>Drop image here</p>\r\n      <p>Or</p>\r\n    </div>\r\n    <label for=\"file-upload\" class=\"file-upload-button\"> Upload </label>\r\n    <input id=\"file-upload\" type=\"file\" multiple @change=\"uploadFiles\" />\r\n    <div class=\"drop-area-image\">\r\n      <image-preview\r\n          v-for=\"(image, index) in previewImageList\"\r\n          :imageId=\"image.imageId\"\r\n          :imageSrc=\"image.imageSrc\"\r\n          :removeImage=\"removeImage\"\r\n          :key=\"index\"\r\n          @remove=\"removePreviewImage(image.imageId)\"\r\n      >\r\n      </image-preview>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { defineComponent } from \"vue\";\r\n\r\nimport ImagePreview from \"./ImagePreview.vue\";\r\n\r\nconst MAX_NUM_IMAGES = 9;\r\n\r\nexport default defineComponent({\r\n  props: {\r\n    processImage: {\r\n      type: Function,\r\n      required: true,\r\n    },\r\n    removeImage: {\r\n      type: Function,\r\n      required: true,\r\n    },\r\n  },\r\n  components: {\r\n    ImagePreview,\r\n  },\r\n  data() {\r\n    return {\r\n      draggedOver: false,\r\n      numPreviewImages: 0,\r\n      numProcessingImage: 0,\r\n      previewImageList: [],\r\n      imageUrlMap: {},\r\n    };\r\n  },\r\n  methods: {\r\n    customPreventDefault(event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    },\r\n    previewImage(image, imageId) {\r\n      const fileReader = new FileReader();\r\n      fileReader.readAsDataURL(image);\r\n      fileReader.onloadend = () => {\r\n        this.previewImageList.push({\r\n          imageSrc: fileReader.result,\r\n          imageId: imageId,\r\n        });\r\n        this.numPreviewImages += 1;\r\n        this.numProcessingImage -= 1;\r\n        if (this.numProcessingImage === 0) {\r\n          // Finish processing and displaying all images\r\n          this.emitUrlList();\r\n        }\r\n      };\r\n    },\r\n    async handleImage(image) {\r\n      const { imageId, imageUrl } = await this.processImage(image).catch(\r\n          (err) => {\r\n            console.log(\"Error processing image: \", err);\r\n            return {\r\n              imageId: undefined,\r\n              imageUrl: undefined,\r\n            };\r\n          }\r\n      );\r\n      if (!imageId || !imageUrl) {\r\n        return;\r\n      }\r\n      this.imageUrlMap[imageId] = imageUrl;\r\n      this.previewImage(image, imageId);\r\n    },\r\n    processImagesFromFiles(files) {\r\n      const uploadedImages = [...files].filter((file) => {\r\n        return file.type.startsWith(\"image\");\r\n      });\r\n      this.numProcessingImage = Math.min(\r\n          uploadedImages.length,\r\n          MAX_NUM_IMAGES - this.numPreviewImages\r\n      );\r\n      const processedImages = uploadedImages.slice(0, this.numProcessingImage);\r\n      processedImages.forEach(this.handleImage);\r\n    },\r\n    uploadFiles(event) {\r\n      if (this.numPreviewImages >= MAX_NUM_IMAGES) {\r\n        return;\r\n      }\r\n      const uploadedFiles = event.target.files;\r\n      if (!uploadedFiles) {\r\n        return;\r\n      }\r\n      this.processImagesFromFiles(uploadedFiles);\r\n    },\r\n    dropFiles(event) {\r\n      if (this.numPreviewImages >= MAX_NUM_IMAGES) {\r\n        return;\r\n      }\r\n      if (!event.dataTransfer) {\r\n        return;\r\n      }\r\n      if (!event.dataTransfer.files.length) {\r\n        return;\r\n      }\r\n      this.draggedOver = false;\r\n      this.processImagesFromFiles(event.dataTransfer.files);\r\n    },\r\n    removePreviewImage(imageId) {\r\n      delete this.imageUrlMap[imageId];\r\n      this.emitUrlList();\r\n      this.numPreviewImages -= 1;\r\n    },\r\n    emitUrlList() {\r\n      const updatedUrlList = Object.keys(this.imageUrlMap).map(\r\n          (key) => this.imageUrlMap[key]\r\n      );\r\n      this.$emit(\"update-urls\", updatedUrlList);\r\n    },\r\n  },\r\n  created() {\r\n    [\"dragover\", \"drop\"].forEach((eventName) => {\r\n      document.addEventListener(eventName, this.customPreventDefault);\r\n    });\r\n  },\r\n  mounted() {\r\n    // Prevent browser from opening dragged images in a new tab\r\n    // and the drop event can be handled by our callback\r\n    [\"dragover\", \"drop\"].forEach((eventName) => {\r\n      this.$refs.dropArea.addEventListener(\r\n          eventName,\r\n          this.customPreventDefault\r\n      );\r\n    });\r\n\r\n    this.$refs.dropArea.addEventListener(\"drop\", this.dropFiles);\r\n    // Show / hide highlight animation on drop area when files are dragged in / out\r\n    this.$refs.dropArea.addEventListener(\"dragenter\", () => {\r\n      this.draggedOver = true;\r\n    });\r\n    this.$refs.dropArea.addEventListener(\"dragleave\", (event) => {\r\n      const dropAreaPosition = this.$refs.dropArea.getBoundingClientRect();\r\n      // Only disable highlight animation when dragleave events occurs outside of drop area.\r\n      // By default, dragleave event occurs when dragging into child elements (still inside drop area).\r\n      const surplusGap = 10; //px\r\n      if (\r\n          event.clientX >= dropAreaPosition.left + surplusGap &&\r\n          event.clientX <= dropAreaPosition.right - surplusGap &&\r\n          event.clientY >= dropAreaPosition.top + surplusGap &&\r\n          event.clientY <= dropAreaPosition.bottom - surplusGap\r\n      ) {\r\n        return;\r\n      }\r\n      this.draggedOver = false;\r\n    });\r\n  },\r\n  beforeUnmount() {\r\n    [\"dragover\", \"drop\"].forEach((eventName) => {\r\n      document.removeEventListener(eventName, this.customPreventDefault);\r\n    });\r\n  },\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.drop-area {\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 5px;\r\n  height: 240px;\r\n  background: #f7f7f7;\r\n  border-radius: 4px;\r\n  border: 1px dashed grey;\r\n  max-width: 300px;\r\n  margin: 0 auto;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n}\r\n.drop-area :where(.fa-camera, .drop-area-text) {\r\n  pointer-events: none;\r\n}\r\n.drop-area-image {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  display: grid;\r\n  grid-template-columns: repeat(3, 1fr);\r\n  gap: 12px;\r\n  width: 100%;\r\n  padding: 15px;\r\n  box-sizing: border-box;\r\n  justify-items: center;\r\n  align-items: center;\r\n}\r\n.drop-area > .fa-camera {\r\n  font-size: 30px;\r\n  color: #c2c2c2;\r\n}\r\n.drop-area-text {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 3px;\r\n  position: relative;\r\n  top: 7px;\r\n  font-size: 15px;\r\n  color: grey;\r\n}\r\n.drop-area-text > p {\r\n  margin: 0;\r\n}\r\n.drop-area-text > p:nth-child(2) {\r\n  font-size: 14px;\r\n}\r\n.drop-area-text > label {\r\n  font-size: 16px;\r\n}\r\n.file-upload-button {\r\n  position: absolute;\r\n  bottom: 10px;\r\n  display: block;\r\n  width: 100px;\r\n  background: white;\r\n  cursor: pointer;\r\n  border: 1px solid #bdbdbd;\r\n  border-radius: 4px;\r\n  box-sizing: border-box;\r\n  padding: 3px;\r\n  color: grey;\r\n}\r\ninput[type=\"file\"] {\r\n  display: none;\r\n}\r\n.hide {\r\n  display: none;\r\n}\r\n.highlight {\r\n  box-shadow: 0 0 7px 5px lightblue;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}